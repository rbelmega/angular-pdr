"use strict";var mainApp=angular.module("mainApp",["ngRoute"]);mainApp.config(function($routeProvider){$routeProvider.when("/",{controller:"topics",templateUrl:"view/list.html"}).when("/show/:id",{controller:"item",templateUrl:"view/item.html"}).when("/signs",{controller:"signCtrl",templateUrl:"view/pictures.html"}).when("/signs/:sign",{controller:"signCtrl",templateUrl:"view/sign.html"}).when("/search/:searchText",{controller:"search",templateUrl:"view/search.html"})});var body=document.getElementsByClassName("container-view")[0],timer;window.addEventListener("scroll",function(){clearTimeout(timer),body.classList.contains("disable-hover")||body.classList.add("disable-hover"),timer=setTimeout(function(){body.classList.remove("disable-hover")},500)},!1),function(){mainApp.factory("cordovaReady",function(){return function(fn){var queue=[],impl=function(){queue.push(Array.prototype.slice.call(arguments))};return document.addEventListener("deviceready",function(){queue.forEach(function(args){fn.apply(this,args)}),impl=fn},!1),function(){return impl.apply(this,arguments)}}})}();var controllers={};controllers.mainCtrl=function($rootScope,$scope,$location,$timeout){function beforeExit(e){e.preventDefault(),document.removeEventListener("backbutton",beforeExit,!1),document.addEventListener("backbutton",exitFromApp,!1),$scope.showExit=!0,$scope.$digest(),$timeout(function(){document.addEventListener("backbutton",beforeExit,!1),document.removeEventListener("backbutton",exitFromApp,!1),$scope.showExit=!1},2e3)}function exitFromApp(e){e.preventDefault(),navigator.app.exitApp()}$scope.showExit=!1,$scope.activeMenu="home",$scope.showSearch=!1,$scope.showControlls=!1,$scope.topicName="Головна",$scope.showSearchOverlay=!1,$scope.selectedMenuItem=[],$scope.selectedMenuItem.push("home"),$scope.showMain=function(){$scope.selectedMenuItem.pop(),$scope.selectedMenuItem.push("home"),$scope.go("/"),$scope.topicName="Головна",$scope.activeMenu="home",$scope.showSearchOverlay=!1},$scope.showSigns=function(){$scope.selectedMenuItem.pop(),$scope.selectedMenuItem.push("signs"),$scope.go("/signs"),$scope.topicName="Дорожні знаки",$scope.activeMenu="signs",$scope.showSearchOverlay=!1},$scope.showSearchPage=function(){$scope.searchText="",$scope.showSearch=!$scope.showSearch,$scope.activeMenu="search",$scope.showSearchOverlay=!$scope.showSearchOverlay,$scope.showSearch?$scope.tmpSearch=$scope.selectedMenuItem[0]:$scope.activeMenu=$scope.selectedMenuItem[0]},$scope.share=function(){window.plugins.socialsharing.shareViaTwitter("Message via Twitter")},$scope.searchClick=function(searchText){$scope.activeMenu="searchList",$scope.showSearch=!1,$scope.topicName="Пошук: "+searchText,$scope.showSearchOverlay=!1,$scope.selectedMenuItem.pop(),$scope.selectedMenuItem.push("search"),$location.path("/search/"+searchText)},$scope.$on("change",function(event,data){$scope.showControlls=!0,$scope.topicName=data,$scope.showSearch=!1}),$scope.$on("changeActiveMenu",function(event,data){$scope.activeMenu=data,$scope.showControlls=!1}),$scope.back=function(){$scope.showControlls=!1,"home"===$scope.activeMenu&&($scope.topicName="Головна"),"signs"===$scope.activeMenu&&($scope.topicName="Дорожні знаки"),"search"===$scope.activeMenu&&($scope.topicName="Пошук"),history.back()},$scope.go=function(path){$scope.showSearch=!1,$scope.showControlls=!1,$location.path(path)},$scope.animateRibbon=function(){},document.addEventListener("backbutton",beforeExit,!1)},controllers.topics=function($scope,listOfTopic){$scope.lists=listOfTopic.getItems()},controllers.search=function($rootScope,$scope,itemsFactory,$routeParams){$scope.lists=itemsFactory.getFilteredItem($routeParams.searchText)},controllers.item=function($scope,itemsFactory,$routeParams,$compile,listOfTopic,$location){itemsFactory.getItemById(+$routeParams.id+1,function(data){$scope.itemTextCaption=listOfTopic.getItems()[$routeParams.id].name,$scope.arrayItems=data,$scope.itemText=data,$scope.$emit("change",$scope.itemTextCaption)}),$scope.item=$routeParams.id,32==$scope.item&&$location.path("/signs")},controllers.navCtrl=function($scope,itemsFactory,$location){$scope.go=function(path){$location.path(path)}},controllers.signCtrl=function($scope,signFactory,$routeParams){$scope.categories=signFactory.get(),$scope.sign=$routeParams.sign,signFactory.getSignById(+$scope.sign,function(data){$scope.signs=data}),$scope.setTopic=function(topic){$scope.$emit("change",topic)},!$scope.sign&&$scope.$emit("change","Дорожні знаки"),!$scope.sign&&$scope.$emit("changeActiveMenu","signs")};var directives={};directives.repeatDone=function(){return function(scope,element,attrs){scope.$last&&scope.$eval(attrs.repeatDone)}},mainApp.directive(directives),mainApp.controller(controllers);var factories={};factories.listOfTopic=function(){var factory={},items=[{id:1,name:"Загальні положення"},{id:2,name:"Обов'язки і права водіїв механічних транспортних засобів"},{id:2,name:"Рух транспортних засобів із спеціальними сигналами"},{id:2,name:"Обов'язки і права пішоходів"},{id:2,name:"Обов'язки і права пасажирів"},{id:2,name:"Вимоги до велосипедистів"},{id:2,name:"Вимоги до осіб, які керують гужовим транспортом і погоничів тварин"},{id:2,name:"Регулювання дорожнього руху"},{id:2,name:"Попереджувальні сигнали"},{id:2,name:"Початок руху та зміна його напрямку"},{id:2,name:"Розташування транспортних засобів на дорозі"},{id:2,name:"Швидкість руху"},{id:2,name:"Дистанція, інтервал, зустрічний роз'їзд"},{id:2,name:"Обгін"},{id:2,name:"Зупинка і стоянка"},{id:2,name:"Проїзд перехресть"},{id:2,name:"Переваги маршрутних транспортних засобів"},{id:2,name:"Проїзд пішохідних переходів і зупинок транспортних засобів"},{id:2,name:"Використання зовнішніх світлових приладів"},{id:2,name:"Рух через залізничні переїзди"},{id:2,name:"Перевезення пасажирів"},{id:2,name:"Перевезення вантажу"},{id:2,name:"Буксирування та експлуатація транспортних составів"},{id:2,name:"Навчальна їзда"},{id:2,name:"Рух транспортних засобів у колонах"},{id:2,name:"Рух у житловій та пішохідній зоні"},{id:2,name:"Рух по автомагістралях і дорогах для автомобілів"},{id:2,name:"Рух по гірських дорогах і на крутих спусках"},{id:2,name:"Міжнародний рух"},{id:2,name:"Номерні, розпізнавальні знаки, написи і позначення"},{id:2,name:"Технічний стан транспортних засобів та їх обладнання"},{id:2,name:"Окремі питання організації дорожнього руху, що потребують узгодження з Державтоінспекцією"},{id:2,name:"Дорожні знаки"},{id:2,name:"Дорожня розмітка"}];return factory.getItems=function(){return items},factory},factories.itemsFactory=function($http){var factory={};return factory.getItemById=function(id,callback){!isNaN(id)&&$http.get("data/"+id+".txt").success(function(data){callback(data)})},factory.getFilteredItem=function(filter){return data.filter(function(item){return item.text.search(filter)>-1})},factory},factories.signFactory=function($http){var factory={},data=[{id:"1",desc:"Попереджувальні знаки",img:"img/sign/1/main.jpg"},{id:"2",desc:"Знаки пріоритету",img:"img/sign/2/main.gif"},{id:"3",desc:"Заборонні знаки",img:"img/sign/3/main.gif"},{id:"4",desc:"Наказові знаки",img:"img/sign/4/main.gif"},{id:"5",desc:"Інформаційно-вказівні знаки",img:"img/sign/5/main.gif"},{id:"6",desc:"Знаки сервісу",img:"img/sign/6/main.gif"},{id:"7",desc:"Таблички до дорожніх знаків",img:"img/sign/7/main.gif"}];return factory.get=function(){return data},factory.getSignById=function(id,callback){!isNaN(id)&&$http.get("data/signs/"+id+".txt").success(function(data){callback(data)})},factory},mainApp.factory(factories);var filters={};filters.showSearchText=function($routeParams){return function(input){var pos=input.search($routeParams.searchText),element=input.substring(pos,pos+$routeParams.searchText.length);return element}},filters.part1=function($routeParams){return function(input){var regex=/(<([^>]+)>)/gi;input=input.replace(regex,"");var pos=input.search($routeParams.searchText);return input.substring(pos-100||0,pos)}},filters.part2=function($routeParams){return function(input){var regex=/(<([^>]+)>)/gi;input=input.replace(regex,"");var pos=input.search($routeParams.searchText);return input.substring(pos+$routeParams.searchText.length,pos+$routeParams.searchText.length+100)}},mainApp.filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),mainApp.filter(filters);